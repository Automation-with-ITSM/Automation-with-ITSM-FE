name: Create Jira Task from GitHub Issue
on:
  issues:
    types: [opened]

jobs:
  create_jira_issue:
    runs-on: ubuntu-latest
    steps:
      - name: Jira Login
        uses: atlassian/gajira-login@v3
        env:
          JIRA_BASE_URL: ${{ secrets.JIRA_BASE_URL }}
          JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}
          JIRA_USER_EMAIL: ${{ secrets.JIRA_USER_EMAIL }}

      - name: Determine Task Type from GitHub Labels
        id: task_type
        run: |
          LABELS='${{ toJson(github.event.issue.labels) }}'
          echo "Labels: $LABELS"
          if echo "$LABELS" | grep -q '"feature"'; then
            echo "TASK_TYPE=Feature" >> $GITHUB_ENV
          elif echo "$LABELS" | grep -q '"fix"'; then
            echo "TASK_TYPE=Fix" >> $GITHUB_ENV
          elif echo "$LABELS" | grep -q '"refactor"'; then
            echo "TASK_TYPE=Refactor" >> $GITHUB_ENV
          else
            echo "TASK_TYPE=General" >> $GITHUB_ENV

      - name: Create Jira Task
        uses: atlassian/gajira-create@v3
        with:
          project: YOUR_PROJECT_KEY
          issuetype: Task
          summary: "[${{ env.TASK_TYPE }}] ${{ github.event.issue.title }}"
          description: |
            GitHub Issue: ${{ github.event.issue.html_url }}
            ${{ github.event.issue.body }}
